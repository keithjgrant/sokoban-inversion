(function(){define("entities/BlockGrid",[],function(){var e;return e=function(){function e(e){this.eventBus=e,this.blocks=[],this.eventBus.on("player:movement",this._handlePlayerMovement)}return e.prototype.addBlock=function(e){var t,n;return t=e.getColumn(),n=e.getRow(),this.blocks[n]||(this.blocks[n]=[]),this.blocks[n][t]=e},e.prototype.findBlock=function(e,t){var n,r;return e instanceof Array&&(n=e,e=n[0],t=n[1]),((r=this.blocks[t])!=null?r[e]:void 0)||null},e.prototype._handlePlayerMovement=function(e){return this._playerCanStep(e)?e.resolve():this._playerCanPushBlock(e)?e.resolve():e.reject()},e.prototype._playerCanStep=function(e){var t,n;return n=this.findBlock(e.getOriginCoords()),t=this.findBlock(e.getDestinationCoords()),n.getColor()===(t!=null?t.getColor():void 0)},e.prototype._playerCanPushBlock=function(e){var t,n,r,i,s,o;return i=this.findBlock(e.getOriginCoords()),t=this.findBlock(e.getDestinationCoords()),s=this.findBlock(e.getNextCoords()),r=i.getColor(),n=t!=null?t.getColor():void 0,o=s!=null?s.getColor():void 0,r!==n&&r===o},e}()})}).call(this),function(){define("Level",["entities/BlockGrid"],function(e){var t;return t=function(){function t(){this.blocks=new e,this.goals=[]}return t.prototype.setPlayer=function(e){this.player=e},t.prototype.getPlayer=function(){return this.player},t.prototype.addBlock=function(e){return this.blocks.addBlock(e)},t.prototype.getBlocks=function(){return this.blocks},t.prototype.addGoal=function(e){return this.goals.push(e)},t.prototype.getGoals=function(){return this.goals},t.prototype.isComplete=function(){var e,t,n,r,i;i=this.goals;for(t=n=0,r=i.length;n<r;t=++n){e=i[t];if(!e.isSatisfied(this.blocks))return!1}return!0},t}()})}.call(this),function(){define("entities/Block",[],function(){var e;return e=function(){function e(e,t){this.col=e,this.row=t}return e.prototype.getCoords=function(){return[this.col,this.row]},e.prototype.getColumn=function(){return this.col},e.prototype.getRow=function(){return this.row},e.prototype.setNeighbors=function(e){return this.north=e.north,this.east=e.east,this.south=e.south,this.west=e.west},e}()})}.call(this),function(){define("entities/colors",[],function(){var e;return e={WHITE:"white",BLUE:"blue",RED:"red",WALL:"wall",GATEWAY:"gateway"}})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("entities/Wall",["entities/Block","entities/colors"],function(e,n){var r,i;return r=function(e){function r(){return i=r.__super__.constructor.apply(this,arguments),i}return t(r,e),r.prototype.isPushable=function(){return!1},r.prototype.getColor=function(){return n.WALL},r}(e)})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("entities/PushableBlock",["entities/Block"],function(e){var n,r;return n=function(e){function n(){return r=n.__super__.constructor.apply(this,arguments),r}return t(n,e),n.prototype.setKeystone=function(e){this._isKeystone=e!=null?e:!0},n.prototype.isKeystone=function(){return this._isKeystone||!1},n.prototype.setColor=function(e){this.color=e},n.prototype.getColor=function(){return this.color},n.prototype.isPushable=function(){return!0},n.prototype.canPushNorth=function(){return this._canPush(this.south,this.north)},n.prototype.canPushSouth=function(){return this._canPush(this.south,this.north)},n.prototype.canPushEast=function(){return this._canPush(this.west,this.east)},n.prototype.canPushWest=function(){return this._canPush(this.east,this.west)},n.prototype._canPush=function(e,t){return this.getColor()===t.getColor()?!1:e.getColor()!==t.getColor()?!1:!0},n}(e)})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("entities/Gateway",["entities/Block","entities/colors"],function(e,n){var r,i;return r=function(e){function r(){return i=r.__super__.constructor.apply(this,arguments),i}return t(r,e),r.prototype.isPushable=function(){return!1},r.prototype.getColor=function(){return n.GATEWAY},r}(e)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("parser/BlockFactory",["entities/Wall","entities/PushableBlock","entities/Gateway","entities/colors"],function(t,n,r,i){var s;return s=function(){function s(){this._createGateway=e(this._createGateway,this),this._createPushableRedKeystone=e(this._createPushableRedKeystone,this),this._createPushableRed=e(this._createPushableRed,this),this._createPushableBlueKeystone=e(this._createPushableBlueKeystone,this),this._createPushableBlue=e(this._createPushableBlue,this),this._createPushableWhiteKeystone=e(this._createPushableWhiteKeystone,this),this._createPushableWhite=e(this._createPushableWhite,this),this._createWall=e(this._createWall,this),this.blockByChar={w:this._createWall,a:this._createPushableWhite,A:this._createPushableWhiteKeystone,b:this._createPushableBlue,B:this._createPushableBlueKeystone,c:this._createPushableRed,C:this._createPushableRedKeystone,g:this._createGateway}}return s.prototype.createBlock=function(e,t,n){var r;return r=this.blockByChar[e],r(t,n)},s.prototype._createWall=function(e,n){return new t(e,n)},s.prototype._createPushableWhite=function(e,t){var r;return r=new n(e,t),r.setColor(i.WHITE),r},s.prototype._createPushableWhiteKeystone=function(e,t){var n;return n=this._createPushableWhite(e,t),n.setKeystone(),n},s.prototype._createPushableBlue=function(e,t){var r;return r=new n(e,t),r.setColor(i.BLUE),r},s.prototype._createPushableBlueKeystone=function(e,t){var n;return n=this._createPushableBlue(e,t),n.setKeystone(),n},s.prototype._createPushableRed=function(e,t){var r;return r=new n(e,t),r.setColor(i.RED),r},s.prototype._createPushableRedKeystone=function(e,t){var n;return n=this._createPushableRed(e,t),n.setKeystone(),n},s.prototype._createGateway=function(e,t){return new r(e,t)},s}()})}.call(this),function(){define("entities/Goal",[],function(){var e;return e=function(){function e(e,t){this.col=e,this.row=t}return e.prototype.getCoords=function(){return[this.col,this.row]},e.prototype.getColumn=function(){return this.col},e.prototype.getRow=function(){return this.row},e.prototype.setColor=function(e){this.color=e},e.prototype.getColor=function(){return this.color},e.prototype.isSatisfied=function(e){var t;return t=e.findBlock(this.col,this.row),t?t.getColor()===this.getColor():!1},e}()})}.call(this),function(){define("parser/GoalFactory",["entities/Goal","entities/colors"],function(e,t){var n;return n=function(){function n(){this.goalByChar={w:this._createWhite,b:this._createBlue,r:this._createRed}}return n.prototype.createGoal=function(e,t,n){var r;return r=this.goalByChar[e],r(t,n)},n.prototype._createWhite=function(n,r){var i;return i=new e(n,r),i.setColor(t.WHITE),i},n.prototype._createBlue=function(n,r){var i;return i=new e(n,r),i.setColor(t.BLUE),i},n.prototype._createRed=function(n,r){var i;return i=new e(n,r),i.setColor(t.RED),i},n}()})}.call(this),function(){define("PlayerMovementEvent",[],function(){var e,t;return t={PENDING:"pending",RESOLVED:"resolved",REJECTED:"rejected"},e=function(){function e(e,n){this.originCoords=e,this.coordDeltas=n,this.state=t.PENDING,this.onSuccess=[],this.onFailure=[]}return e.prototype.getState=function(){return this.state},e.prototype.getOriginCoords=function(){return this.originCoords},e.prototype.getDestinationCoords=function(){var e,t;return e=this.originCoords[0]+this.coordDeltas[0],t=this.originCoords[1]+this.coordDeltas[1],[e,t]},e.prototype.getNextCoords=function(){var e,t;return e=this.originCoords[0]+2*this.coordDeltas[0],t=this.originCoords[1]+2*this.coordDeltas[1],[e,t]},e.prototype.resolve=function(){var e,t,n,r,i;r=this.onSuccess,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e(this));return i},e.prototype.reject=function(){var e,t,n,r,i;r=this.onFailure,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e(this));return i},e.prototype.done=function(e){return this.onSuccess.push(e)},e.prototype.fail=function(e){return this.onFailure.push(e)},e.prototype.then=function(e,t){return this.done(e),this.fail(t)},e}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("entities/Player",["PlayerMovementEvent"],function(t){var n;return n=function(){function n(t,n,r){this.eventBus=t,this.col=n,this.row=r,this._handleMovementDone=e(this._handleMovementDone,this),this._handleMovementFailure=e(this._handleMovementFailure,this),this._moveWest=e(this._moveWest,this),this._moveSouth=e(this._moveSouth,this),this._moveEast=e(this._moveEast,this),this._moveNorth=e(this._moveNorth,this),this.isMoving=!1,this.eventBus.on("user:up",this._moveNorth),this.eventBus.on("user:right",this._moveEast),this.eventBus.on("user:down",this._moveSouth),this.eventBus.on("user:left",this._moveWest)}return n.prototype.getCoords=function(){return[this.col,this.row]},n.prototype.getColumn=function(){return this.col},n.prototype.getRow=function(){return this.row},n.prototype._moveNorth=function(){return this._move(0,-1)},n.prototype._moveEast=function(){return this._move(1,0)},n.prototype._moveSouth=function(){return this._move(0,1)},n.prototype._moveWest=function(){return this._move(-1,0)},n.prototype._move=function(e,n){var r;return this.col+=e,this.row+=n,this.isMoving=!0,r=new t(this.getCoords,[e,n]),r.then(this._handleMovementDone,this._handleMovementFailure),this.eventBus.trigger("player:movement",r)},n.prototype._handleMovementFailure=function(e){var t;return t=e.getOriginCoords(),this.col=t[0],this.row=t[1],this.isMoving=!1},n.prototype._handleMovementDone=function(e){return this.isMoving=!1},n}()})}.call(this),function(){define("parser/LevelParser",["Level","parser/BlockFactory","parser/GoalFactory","entities/Player"],function(e,t,n,r){var i;return i=function(){function i(e){this.eventBus=e,this.blockFactory=new t,this.goalFactory=new n}return i.prototype.parse=function(t){return this.data=t,this.level=new e,this._parseBlocks(),this._parseGoals(),this._parsePlayer(),this.level},i.prototype._parseBlocks=function(){var e,t,n,r,i,s,o,u,a;u=this.data.blocks,a=[];for(i=s=0,o=u.length;s<o;i=++s)r=u[i],a.push(function(){var s,o,u;u=[];for(n=s=0,o=r.length-1;0<=o?s<=o:s>=o;n=0<=o?++s:--s)t=r[n],e=this.blockFactory.createBlock(t,n,i),u.push(this.level.addBlock(e));return u}.call(this));return a},i.prototype._parseGoals=function(){var e,t,n,r,i,s,o,u,a;u=this.data.goals,a=[];for(s=0,o=u.length;s<o;s++)n=u[s],t=n[0],i=n[1],e=n[2],r=this.goalFactory.createGoal(e,t,i),a.push(this.level.addGoal(r));return a},i.prototype._parsePlayer=function(){var e,t,n;return e=this.data.player[0],n=this.data.player[1],t=new r(this.eventBus,e,n),this.level.setPlayer(t)},i}()})}.call(this),function(){define("renderers/LevelRenderer",[],function(){var e;return e=function(){function e(e){this.level=e,this._createBlockRenderers(),this._createGoalRenderers(),this._createPlayerRenderer()}return e.prototype._createBlockRenderers=function(){var e,t,n,r,i,s;this.blockRenderers=[],i=this.level.getBlocks(),s=[];for(n=0,r=i.length;n<r;n++)e=i[n],t=new BlockRenderer(e),s.push(this.blockRenderers.push(renderer));return s},e}()})}.call(this),function(){define("levels",[],function(){return[{blocks:["wwwwwwwwwwwwwwww","wwwwwwwwwwwwwwww","wwwwwaawaaawwwww","wwwwwaaBaaaaawww","wwwwaaawwBwaawww","wwwwaBawaawawwww","wwwwwwBwaawawwww","wwwwwwaBaaaawwww","wwwwwwBwawaawwww","wwwwwwaaawwwwwww","wwwwwwwwwwwwwwww","wwwwwwwwwwwwwwww","wwwwwwwwwwwwwwww"],goals:[[8,5,"b"],[8,6,"b"],[8,7,"b"],[9,5,"b"],[9,6,"b"],[9,7,"b"]],player:[6,7]},["wwwwwwwwwwwwwwww","wwwwwwwwwwwwwwww","wwwwwwwwwwwwwwww","wwwwwwwwwwwwwwww","wwwwwwwwwwwwwwww","wwwwwwwwwwwwwwww","wwwwwwwwwwwwwwww","wwwwwwwwwwwwwwww","wwwwwwwwwwwwwwww","wwwwwwwwwwwwwwww","wwwwwwwwwwwwwwww","wwwwwwwwwwwwwwww"]]})}.call(this),function(){define("scenes/LevelScene",["parser/LevelParser","renderers/LevelRenderer","levels"],function(e,t,n){var r;return r=function(){function r(e,n){this.eventBus=e,this.levelNum=n,this._generateLevel(),this.renderer=new t(this.level)}return r.prototype._generateLevel=function(){var t,r;return t=n[this.levelNum],r=new e(this.eventBus),this.level=r.parse(t)},r}()})}.call(this),function(){define("Game",["scenes/LevelScene"],function(e){var t;return t=function(){function t(e){this.eventBus=e,this.loadTitleScene()}return t.prototype.loadTitleScene=function(){},t.prototype.loadLevelScene=function(t){return this.currentScene=new e(t)},t}()})}.call(this),function(){define("config",[],function(){var e;return e={W:87,A:65,S:83,D:68,UP_ARROW:38,DOWN_ARROW:40,LEFT_ARROW:37,RIGHT_ARROW:39,ESC:27,ENTER:13,SPACEBAR:32},{controls:{up:[e.W,e.UP_ARROW],down:[e.S,e.DOWN_ARROW],left:[e.A,e.LEFT_ARROW],right:[e.D,e.RIGHT_ARROW],esc:[e.ESC],select:[e.ENTER,e.SPACEBAR]},tileSize:32,debug:!0}})}.call(this),function(){define("EventBus",["config"],function(e){var t;return t=function(){function t(){this.callbacks=[]}return t.prototype.on=function(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t)},t.prototype.one=function(e,t){var n,r=this;return n=function(){return t(),r.off(e,n)},this.on(e,n)},t.prototype.off=function(e,t){var n,r,i,s,o,u;o=this.callbacks[e],u=[];for(r=i=0,s=o.length;i<s;r=++i)n=o[r],n===t&&u.push(this.callbacks[e].splice(r,1));return u},t.prototype.trigger=function(e,t){this._logEvent(e,t);if(this.callbacks[e])return this.callbacks[e].forEach(function(e){return e.call(this,t)})},t.prototype._logEvent=function(t,n){if(e.debug)return console.log("> "+t,n||"")},t}()})}.call(this),function(){requirejs.config({baseUrl:"."}),require(["Game","EventBus"],function(e,t){var n,r;return n=new t,r=new e(n)})}.call(this),define("main",function(){});